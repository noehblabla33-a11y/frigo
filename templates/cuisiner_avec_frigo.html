{% extends "base.html" %}
{% block title %}Que puis-je cuisiner ?{% endblock %}

{% block content %}
<div class="page-header">
    <h2>ü•ò Que puis-je cuisiner avec mon frigo ?</h2>
    <p>D√©couvrez les recettes que vous pouvez r√©aliser avec vos ingr√©dients en stock</p>
</div>

<!-- Statistiques rapides -->
<div class="stats-grid" style="margin-bottom: 30px;">
    <div class="stat-card">
        <div class="stat-number">{{ nb_realisables }}</div>
        <div class="stat-label">Recette(s) r√©alisable(s) maintenant</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ recettes_partielles|length }}</div>
        <div class="stat-label">Recette(s) partiellement possible(s)</div>
    </div>
</div>

<!-- Recettes r√©alisables imm√©diatement -->
{% if recettes_realisables %}
<div class="card">
    <h3>‚úÖ Recettes r√©alisables imm√©diatement</h3>
    <p style="color: #28a745; margin-bottom: 20px;">
        Vous avez tous les ingr√©dients n√©cessaires pour ces recettes !
    </p>
    
    <div class="recettes-grid">
        {% for item in recettes_realisables %}
        {% set recette = item.recette %}
        <div class="recette-card">
            <a href="{{ url_for('recettes.detail', id=recette.id) }}" class="recette-link">
                <div class="recette-image">
                    {% if recette.image %}
                    <img src="{{ url_for('static', filename=recette.image.replace('static/', '')) }}" 
                         alt="{{ recette.nom }}"
                         loading="lazy">
                    {% else %}
                    <div class="no-image">üç≥</div>
                    {% endif %}
                    
                    <!-- Badge type √† GAUCHE -->
                    {% if recette.type_recette %}
                    <span class="recette-type-badge">{{ recette.type_recette }}</span>
                    {% endif %}
                    
                    <!-- Badge "R√©alisable" √† DROITE -->
                    <span class="badge-realisable">‚úì R√©alisable</span>
                </div>
                <div class="recette-info">
                    <h4>{{ recette.nom }}</h4>
                    <div class="recette-meta">
                        <span class="recette-ingredients-count">{{ recette.ingredients|length }} ingr√©dient(s)</span>
                        {% if recette.temps_preparation %}
                        <span class="recette-temps">‚è±Ô∏è {{ recette.temps_preparation }} min</span>
                        {% endif %}
                    </div>
                    
                    <!-- Barre de progression √† 100% -->
                    <div class="disponibilite-bar">
                        <div class="disponibilite-progress" style="width: 100%; background: #28a745;"></div>
                    </div>
                    <p class="disponibilite-text" style="color: #28a745;">
                        100% des ingr√©dients disponibles
                    </p>
                    
                    {% set cout = recette.calculer_cout() %}
                    {% if cout > 0 %}
                    <p class="recette-cout">‚âà {{ cout }}‚Ç¨</p>
                    {% endif %}
                </div>
            </a>
            <div class="recette-actions">
                <form method="POST" 
                      action="{{ url_for('recettes.planifier_rapide', id=recette.id) }}" 
                      style="display: inline;">
                    <button type="submit" 
                            class="btn btn-small"
                            style="background: #28a745; color: white;">
                        üìÖ Planifier
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Recettes partiellement r√©alisables -->
{% if recettes_partielles %}
<div class="card">
    <h3>üìä Recettes partiellement r√©alisables</h3>
    <p style="color: #6c757d; margin-bottom: 20px;">
        Tri√©es par pourcentage d'ingr√©dients disponibles
    </p>
    
    <div class="recettes-grid">
        {% for item in recettes_partielles[:12] %}
        {% set recette = item.recette %}
        {% set dispo = item.disponibilite %}
        <div class="recette-card">
            <a href="{{ url_for('recettes.detail', id=recette.id) }}" class="recette-link">
                <div class="recette-image">
                    {% if recette.image %}
                    <img src="{{ url_for('static', filename=recette.image.replace('static/', '')) }}" 
                         alt="{{ recette.nom }}"
                         loading="lazy">
                    {% else %}
                    <div class="no-image">üç≥</div>
                    {% endif %}
                    
                    {% if recette.type_recette %}
                    <span class="recette-type-badge">{{ recette.type_recette }}</span>
                    {% endif %}
                </div>
                <div class="recette-info">
                    <h4>{{ recette.nom }}</h4>
                    <div class="recette-meta">
                        <span class="recette-ingredients-count">{{ recette.ingredients|length }} ingr√©dient(s)</span>
                        {% if recette.temps_preparation %}
                        <span class="recette-temps">‚è±Ô∏è {{ recette.temps_preparation }} min</span>
                        {% endif %}
                    </div>
                    
                    <!-- Barre de progression -->
                    <div class="disponibilite-bar">
                        <div class="disponibilite-progress" 
                             style="width: {{ dispo.pourcentage }}%; 
                                    background: {% if dispo.pourcentage >= 75 %}#ffc107{% elif dispo.pourcentage >= 50 %}#ff9800{% else %}#f44336{% endif %};">
                        </div>
                    </div>
                    <p class="disponibilite-text" 
                       style="color: {% if dispo.pourcentage >= 75 %}#ffc107{% elif dispo.pourcentage >= 50 %}#ff9800{% else %}#f44336{% endif %};">
                        {{ dispo.pourcentage }}% des ingr√©dients disponibles
                        <br>
                        <small>{{ dispo.ingredients_manquants|length }} ingr√©dient(s) manquant(s)</small>
                    </p>
                    
                    {% set cout = recette.calculer_cout() %}
                    {% if cout > 0 %}
                    <p class="recette-cout">‚âà {{ cout }}‚Ç¨</p>
                    {% endif %}
                </div>
            </a>
            <div class="recette-actions">
                <form method="POST" 
                      action="{{ url_for('recettes.planifier_rapide', id=recette.id) }}" 
                      style="display: inline;">
                    <button type="submit" 
                            class="btn btn-small"
                            style="background: #667eea; color: white;">
                        üìÖ Planifier
                    </button>
                </form>
                <a href="{{ url_for('recettes.detail', id=recette.id) }}" 
                   class="btn btn-small"
                   style="background: #6c757d; color: white;">
                    Voir d√©tails
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if recettes_partielles|length > 12 %}
    <p style="margin-top: 20px; text-align: center; color: #6c757d;">
        Et {{ recettes_partielles|length - 12 }} autre(s) recette(s)...
    </p>
    {% endif %}
</div>
{% endif %}

<!-- Message si aucune recette -->
{% if not recettes_realisables and not recettes_partielles %}
<div class="card">
    <p style="text-align: center; color: #6c757d; padding: 40px;">
        Aucune recette trouv√©e. Ajoutez des ingr√©dients √† votre frigo et cr√©ez des recettes !
    </p>
</div>
{% endif %}

<!-- Styles sp√©cifiques -->
<style>
.badge-realisable {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #28a745;
    color: white;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
    z-index: 10;
}

.disponibilite-bar {
    width: 100%;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
    margin: 10px 0 5px 0;
}

.disponibilite-progress {
    height: 100%;
    transition: width 0.3s ease;
    border-radius: 4px;
}

.disponibilite-text {
    font-size: 0.9em;
    font-weight: 500;
    margin: 5px 0;
}

.disponibilite-text small {
    font-size: 0.85em;
    opacity: 0.8;
}
</style>
{% endblock %}
