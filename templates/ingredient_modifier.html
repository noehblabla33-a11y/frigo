{% extends "base.html" %}
{% block title %}Modifier {{ ingredient.nom }}{% endblock %}

{% block content %}
<div class="card">
    <h3>‚úèÔ∏è Modifier l'ingr√©dient</h3>
    <form method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label>Nom de l'ingr√©dient</label>
            <input type="text" name="nom" value="{{ ingredient.nom }}" required>
        </div>
        
        <div class="form-group">
            <label>Cat√©gorie</label>
            <select name="categorie" class="searchable-select">
                <option value="">S√©lectionner une cat√©gorie (optionnel)</option>
                {% for cat_name, cat_icon in categories %}
                <option value="{{ cat_name }}" {% if ingredient.categorie == cat_name %}selected{% endif %}>
                    {{ cat_icon }} {{ cat_name }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label>Unit√© de mesure</label>
            <select name="unite">
                <option value="g" {% if ingredient.unite == 'g' %}selected{% endif %}>grammes (g)</option>
                <option value="kg" {% if ingredient.unite == 'kg' %}selected{% endif %}>kilogrammes (kg)</option>
                <option value="ml" {% if ingredient.unite == 'ml' %}selected{% endif %}>millilitres (ml)</option>
                <option value="L" {% if ingredient.unite == 'L' %}selected{% endif %}>litres (L)</option>
                <option value="pi√®ce" {% if ingredient.unite == 'pi√®ce' %}selected{% endif %}>pi√®ce(s)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Prix unitaire (‚Ç¨)</label>
            <input type="number" step="0.001" name="prix_unitaire" 
                value="{{ ingredient.prix_unitaire if ingredient.prix_unitaire else '' }}" 
                placeholder="Prix par {{ ingredient.unite }}" id="prix_input">
            <small style="color: #6c757d;" id="prix_helper">
                {% if ingredient.unite == 'g' %}
                Entrez le prix en ‚Ç¨/g (ex: 0.015 pour 15‚Ç¨/kg)
                {% elif ingredient.unite == 'ml' %}
                Entrez le prix en ‚Ç¨/ml (ex: 0.003 pour 3‚Ç¨/L)
                {% else %}
                Ex: 2.50 pour 2.50‚Ç¨/{{ ingredient.unite }}
                {% endif %}
            </small>
            {% if ingredient.prix_unitaire > 0 and ingredient.unite == 'g' %}
            <small style="color: #28a745; font-weight: bold;">
                üí° √âquivaut √† {{ (ingredient.prix_unitaire * 1000)|round(2) }}‚Ç¨/kg
            </small>
            {% endif %}
        </div>

        <div class="form-group">
            <h4 style="margin-top: 25px; color: #667eea;">üìä Informations nutritionnelles (pour 100g ou 100ml)</h4>
            <p style="color: #6c757d; font-size: 0.9em; margin-bottom: 15px;">
                Renseignez les valeurs nutritionnelles pour 100g ou 100ml de cet ingr√©dient.
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="form-group">
                    <label>Calories (kcal)</label>
                    <input type="number" step="0.1" name="calories" 
                        value="{{ ingredient.calories if ingredient.calories else 0 }}">
                </div>
                
                <div class="form-group">
                    <label>Prot√©ines (g)</label>
                    <input type="number" step="0.1" name="proteines" 
                        value="{{ ingredient.proteines if ingredient.proteines else 0 }}">
                </div>
                
                <div class="form-group">
                    <label>Glucides (g)</label>
                    <input type="number" step="0.1" name="glucides" 
                        value="{{ ingredient.glucides if ingredient.glucides else 0 }}">
                </div>
                
                <div class="form-group">
                    <label>Lipides (g)</label>
                    <input type="number" step="0.1" name="lipides" 
                        value="{{ ingredient.lipides if ingredient.lipides else 0 }}">
                </div>
                
                <div class="form-group">
                    <label>Fibres (g)</label>
                    <input type="number" step="0.1" name="fibres" 
                        value="{{ ingredient.fibres if ingredient.fibres else 0 }}">
                </div>
                
                <div class="form-group">
                    <label>Sucres (g)</label>
                    <input type="number" step="0.1" name="sucres" 
                        value="{{ ingredient.sucres if ingredient.sucres else 0 }}">
                </div>
                
                <div class="form-group">
                    <label>Sel (g)</label>
                    <input type="number" step="0.01" name="sel" 
                        value="{{ ingredient.sel if ingredient.sel else 0 }}">
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label>Image de l'ingr√©dient</label>
            {% if ingredient.image %}
            <div style="margin-bottom: 10px;">
                <img src="{{ url_for('static', filename=ingredient.image.replace('static/', '')) }}" 
                     alt="{{ ingredient.nom }}" 
                     style="max-width: 200px; border-radius: 8px;">
                <p style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">
                    Image actuelle (choisissez un nouveau fichier pour la remplacer)
                </p>
            </div>
            {% endif %}
            <input type="file" name="image" accept="image/*">
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button type="submit" class="btn btn-success">Enregistrer les modifications</button>
            <a href="{{ url_for('ingredients.liste') }}" class="btn">Annuler</a>
        </div>
    </form>
</div>

{% if ingredient.stock %}
<div class="card">
    <h3>üìä Stock actuel</h3>
    <p>Quantit√© en stock : <strong>{{ ingredient.stock.quantite }} {{ ingredient.unite }}</strong></p>
    <p style="color: #6c757d; font-size: 0.9em;">
        Derni√®re modification : {{ ingredient.stock.date_modification.strftime('%d/%m/%Y √† %H:%M') }}
    </p>
    <a href="{{ url_for('frigo.liste') }}" class="btn">G√©rer le stock</a>
</div>
{% else %}
<div class="card">
    <h3>üìä Stock actuel</h3>
    <p>Cet ingr√©dient n'est pas actuellement en stock dans votre frigo.</p>
    <a href="{{ url_for('frigo.liste') }}" class="btn">Ajouter au frigo</a>
</div>
{% endif %}

{% if ingredient.recettes %}
<div class="card">
    <h3>üìñ Utilis√© dans les recettes</h3>
    <p style="margin-bottom: 15px;">
        Cet ingr√©dient est utilis√© dans <strong>{{ ingredient.recettes|length }}</strong> recette(s) :
    </p>
    <ul style="margin-left: 20px; line-height: 2;">
        {% for ing_rec in ingredient.recettes %}
        <li>
            <a href="{{ url_for('recettes.detail', id=ing_rec.recette.id) }}" style="color: #667eea;">
                {{ ing_rec.recette.nom }}
            </a>
            ({{ ing_rec.quantite }} {{ ingredient.unite }})
        </li>
        {% endfor %}
    </ul>
    <p style="color: #dc3545; margin-top: 15px; font-size: 0.9em;">
        ‚ö†Ô∏è Vous ne pouvez pas supprimer cet ingr√©dient tant qu'il est utilis√© dans des recettes.
    </p>
</div>
{% endif %}
{% endblock %}
